#!/usr/bin/env perl
use 5.10.0;
use strict;
use warnings;

my $cache   = "/var/lib/munin/plugin-state/$ARGV[0]";
my $path    = $ARGV[1];
my $command = $ARGV[2];

if ( ! -f $cache || -O $cache ) {
    $command = "du -sk $path" unless $command;
    sys("ionice -c 2 -n 6 nice -n 19 $command > $cache.tmp 2>/dev/null");
    sys("mv $cache.tmp $cache");
}

sub sys {
    my $cmd = shift;
    system $cmd;
}
