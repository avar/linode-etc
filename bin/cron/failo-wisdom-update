#!/usr/bin/env perl
use 5.012;
use autodie;
use strict;

my @format = qw< C Perl Lua >;
my $format = $format[rand @format];
my $out = "/usr/local/bin/failo-wisdom";

my $program = do {
    open my $fh, qq[ curl --silent --user-agent 'cron/failo-wisdom-update' http://u.nix.is/~failo/quotes.yml | quotecc -i - -I YAML -o - -O $format | ];

    join '', <$fh>;
};

given ($format) {
    when ('C') {
        open my $gcc, "| gcc -x c -o $out -";
        print $gcc $program;
        close $gcc;
    }
    default {
        open my $wisdom, ">", $out;
        print $wisdom $program;
        close $wisdom;
    }
}
