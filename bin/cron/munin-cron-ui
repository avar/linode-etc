#!/bin/sh

perl -e '
    my ($load, $baseline) = @ARGV;
    exit 1 if $load >= ($baseline + 0.30);
' \
    $(awk '{print $1}' /proc/loadavg) \
    $(ps aux | awk '{print $8}' | grep '^[ZD]' | wc -l)

if [ $? -eq 0 ] || [ -n "$FORCE" ]; then
    /usr/share/munin/munin-graph $@ || exit 1

    /usr/share/munin/munin-html $@ || exit 1
fi
