#!/bin/sh

if test -z "$1" || ! test -d "$1" ; then
    echo "You must supply a dir= under which git repositories live to operate on"
    exit 1
fi

DIR=$1

for g in $(find $DIR -name '.git' -type d)
do
    git --git-dir=$g repack -A               >/dev/null 2>&1
    git --git-dir=$g prune-packed            >/dev/null 2>&1
    git --git-dir=$g gc --prune              >/dev/null 2>&1
    git --git-dir=$g count-objects -v        >/dev/null 2>&1
done
